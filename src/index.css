@tailwind base;
@tailwind components;
@tailwind utilities;

/* Enhanced iframe modal styles for full screen optimization */
body.iframe-modal-open {
  overflow: hidden !important;
  position: fixed !important;
  width: 100vw !important;
  height: 100vh !important;
  max-width: 100vw !important;
  max-height: 100vh !important;
  /* iOS Safari specific fixes */
  -webkit-overflow-scrolling: touch;
  touch-action: none;
  /* Prevent any scrolling */
  overscroll-behavior: none;
  /* Ensure full screen */
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  bottom: 0 !important;
  /* Force maximum z-index context */
  z-index: 2147483647 !important;
  isolation: isolate !important;
}

/* CRITICAL: iPhone Full-Screen Iframe Overlap Fix */
.booking-iframe-overlay {
  z-index: 2147483647 !important; /* Maximum possible z-index */
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  bottom: 0 !important;
  width: 100vw !important;
  height: 100vh !important;
  max-width: 100vw !important;
  max-height: 100vh !important;
  isolation: isolate !important;
  /* Force above all other elements */
  transform: translateZ(0) !important;
  will-change: transform !important;
}

.booking-iframe-header {
  z-index: 2147483647 !important;
  position: relative !important;
  isolation: isolate !important;
  transform: translateZ(0) !important;
}

.booking-iframe-content {
  z-index: 2147483646 !important;
  position: relative !important;
  isolation: isolate !important;
  transform: translateZ(0) !important;
}

/* Force all other elements below iframe modal */
body.iframe-modal-open > *:not(.booking-iframe-overlay) {
  z-index: 1 !important;
  position: relative !important;
}

/* Specifically target navigation and header elements */
body.iframe-modal-open .fixed,
body.iframe-modal-open .sticky,
body.iframe-modal-open nav,
body.iframe-modal-open header {
  z-index: 1 !important;
  position: relative !important;
}

/* Desktop: Full screen iframe optimizations - Ensure iframe reaches every corner */
.iframe-container {
  /* Force full screen on all devices */
  width: 100vw !important;
  height: calc(100vh - 48px) !important;
  max-height: calc(100vh - 48px) !important;
  min-height: calc(100vh - 48px) !important;
  max-width: 100vw !important;
  min-width: 100vw !important;
  /* iOS Safari specific */
  -webkit-overflow-scrolling: touch;
  overflow: hidden; /* Container doesn't scroll, iframe does */
  /* Optimize touch interactions */
  touch-action: manipulation;
  /* Prevent selection issues */
  -webkit-user-select: none;
  -moz-user-select: none;
  user-select: none;
  /* Prevent iOS Safari from interfering with iframe touch events */
  -webkit-touch-callout: none;
  -khtml-user-select: none;
  -ms-user-select: none;
  /* Ensure exact positioning */
  position: relative;
  display: flex;
  flex-direction: column;
  /* Remove any potential spacing */
  padding: 0 !important;
  margin: 0 !important;
  border: none !important;
  outline: none !important;
  /* Force above other content */
  z-index: 2147483646 !important;
  isolation: isolate !important;
  transform: translateZ(0) !important;
}

.iframe-container iframe {
  /* Enhanced iOS compatibility - iframe handles its own scrolling */
  -webkit-overflow-scrolling: touch !important;
  overflow: auto !important;
  /* Prevent iOS Safari from adding borders */
  border: none !important;
  outline: none !important;
  /* Optimize rendering */
  -webkit-transform: translateZ(0);
  transform: translateZ(0);
  /* Prevent iOS Safari touch delays */
  touch-action: manipulation;
  /* Ensure proper display */
  display: block !important;
  /* Critical: Full screen dimensions */
  width: 100vw !important;
  height: 100% !important;
  max-height: 100% !important;
  min-height: 100% !important;
  max-width: 100vw !important;
  min-width: 100vw !important;
  /* Flex properties for exact sizing */
  flex: 1;
  flex-shrink: 0;
  flex-grow: 1;
  /* Ensure iframe content can scroll */
  overflow-y: auto !important;
  overflow-x: hidden !important;
  /* Remove any potential spacing */
  padding: 0 !important;
  margin: 0 !important;
  /* Ensure exact positioning */
  position: relative;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  /* Force proper layering */
  z-index: 2147483645 !important;
  isolation: isolate !important;
}

/* iPhone/iOS Safari specific full-screen fixes */
@media screen and (max-width: 768px) {
  .iframe-container {
    /* iPhone: Force full screen - NO bottom nav space */
    height: calc(100vh - 48px) !important; /* Only header */
    min-height: calc(100vh - 48px) !important;
    max-height: calc(100vh - 48px) !important;
    width: 100vw !important;
    min-width: 100vw !important;
    max-width: 100vw !important;
    /* Force above navigation */
    z-index: 2147483646 !important;
    isolation: isolate !important;
    transform: translateZ(0) !important;
  }
  
  .iframe-container iframe {
    /* iPhone iframe - full screen */
    height: 100% !important;
    min-height: 100% !important;
    max-height: 100% !important;
    width: 100vw !important;
    min-width: 100vw !important;
    max-width: 100vw !important;
    z-index: 2147483645 !important;
    isolation: isolate !important;
  }
  
  /* Force bottom navigation below iframe */
  body.iframe-modal-open .fixed.bottom-0 {
    z-index: 1 !important;
    position: relative !important;
  }
}

/* iOS Safari specific iframe optimizations */
@supports (-webkit-touch-callout: none) {
  /* iOS Safari - Force full screen overlap */
  .iframe-container {
    /* iOS Safari: Full screen - overlaps navigation */
    height: calc(100vh - 48px) !important; /* Only header */
    min-height: calc(100vh - 48px) !important;
    max-height: calc(100vh - 48px) !important;
    width: 100vw !important;
    min-width: 100vw !important;
    max-width: 100vw !important;
    /* Force above all other elements */
    z-index: 2147483646 !important;
    isolation: isolate !important;
    transform: translateZ(0) !important;
  }
}

/* VKWebView and TWA specific optimizations */
@media screen and (display-mode: standalone) {
  /* PWA/TWA mode optimizations */
  .iframe-container {
    /* PWA/TWA: Full screen overlap */
    height: calc(100vh - 48px) !important; /* Only header */
    max-height: calc(100vh - 48px) !important;
    min-height: calc(100vh - 48px) !important;
    width: 100vw !important;
    max-width: 100vw !important;
    min-width: 100vw !important;
    z-index: 2147483646 !important;
    isolation: isolate !important;
  }
}

/* Force all other elements below iframe modal on iPhone */
@media screen and (max-width: 768px) {
  body.iframe-modal-open > *:not(.booking-iframe-overlay) {
    z-index: 1 !important;
    position: relative !important;
  }
  
  /* Specifically hide bottom navigation when iframe is open */
  body.iframe-modal-open .fixed.bottom-0,
  body.iframe-modal-open nav {
    display: none !important;
  }
}